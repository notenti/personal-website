---
import { Image } from 'astro:assets';

interface Props {
  src: string;
  alt?: string;
  caption?: string;
  aspect?: 'auto' | 'landscape' | 'portrait' | 'square' | '16:9' | '4:3' | '3:2' | '2:3' | '3:4';
  class?: string;
}

const { src, alt = '', caption, aspect = 'auto', class: className = '' } = Astro.props;

// Map aspect prop to CSS aspect ratio
const aspectClasses: Record<string, string> = {
  'auto': '', // Will use natural dimensions from inferSize
  'landscape': 'aspect-[3/2]',
  'portrait': 'aspect-[2/3]',
  'square': 'aspect-square',
  '16:9': 'aspect-[16/9]',
  '4:3': 'aspect-[4/3]',
  '3:2': 'aspect-[3/2]',
  '2:3': 'aspect-[2/3]',
  '3:4': 'aspect-[3/4]',
};

const aspectClass = aspectClasses[aspect] || '';
const useObjectCover = aspect !== 'auto';
---

<figure class={`photo-container m-0 ${className}`}>
  <div class:list={['photo-wrapper relative rounded-sm overflow-hidden bg-stone-200', aspectClass]}>
    <div class="photo-skeleton absolute inset-0 bg-gradient-to-r from-stone-200 via-stone-100 to-stone-200 bg-[length:200%_100%] animate-shimmer" />
    <Image
      src={src}
      alt={alt}
      inferSize
      class:list={[
        'photo-image w-full rounded-sm lightbox-trigger cursor-zoom-in',
        aspectClass,
        useObjectCover ? 'object-cover' : ''
      ]}
      loading="eager"
    />
  </div>
  {caption && (
    <figcaption class="text-center text-xs text-stone-400 mt-1.5 tracking-wide">
      {caption}
    </figcaption>
  )}
</figure>
