---
import BaseLayout from './BaseLayout.astro';
import Lightbox from '../components/Lightbox.astro';

interface Props {
  title: string;
  date: Date;
  cover: string;
  location?: string;
  intro?: string;
}

const { title, date, cover, location, intro } = Astro.props;

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
  });
};
---

<BaseLayout title={`${title} - Nate Otenti`} description={intro}>
  <main class="min-h-screen p-8">
    <div class="max-w-4xl mx-auto p-8">
      <a href="/life" class="font-mono text-sm text-stone-400 hover:text-accent mb-8 inline-block">&larr; life</a>

      <header class="mb-8">
        <h1 class="text-3xl md:text-4xl font-semibold text-stone-900 mb-3">{title}</h1>
        <div class="flex flex-wrap items-center gap-3 text-sm text-stone-500">
          <time class="font-mono">{formatDate(date)}</time>
          {location && (
            <>
              <span class="text-stone-300">Â·</span>
              <span>{location}</span>
            </>
          )}
        </div>
      </header>

      {intro && (
        <p class="text-lg text-stone-600 leading-relaxed mb-10">
          {intro}
        </p>
      )}

      <div class="space-y-2">
        <slot />
      </div>
    </div>
  </main>

  <Lightbox />
</BaseLayout>

<style is:global>
  @keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  .animate-shimmer {
    animation: shimmer 1.5s infinite;
  }

  .photo-image {
    opacity: 0;
    transition: opacity 0.2s ease-out;
  }

  .photo-image.loaded {
    opacity: 1 !important;
  }

  .photo-skeleton {
    transition: opacity 0.15s ease-out;
  }

  .photo-container.loaded .photo-skeleton {
    opacity: 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const containers = document.querySelectorAll('.photo-container');

    containers.forEach((container) => {
      const img = container.querySelector('.photo-image') as HTMLImageElement;

      if (img.complete && img.naturalHeight !== 0) {
        container.classList.add('loaded');
        img.classList.add('loaded');
      } else {
        img.addEventListener('load', () => {
          container.classList.add('loaded');
          img.classList.add('loaded');
        });

        img.addEventListener('error', () => {
          container.classList.add('loaded');
        });
      }
    });
  });
</script>
