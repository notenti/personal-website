---
import BaseLayout from './BaseLayout.astro';
import Lightbox from '../components/Lightbox.astro';
import { getCollection } from 'astro:content';

interface Props {
  title: string;
  description: string;
  date: Date;
  cover: string;
  location?: string;
  blurb?: string;
  slug: string;
}

const { title, description, date, cover, location, blurb, slug } = Astro.props;

// Get other albums for sidebar
const allAlbums = await getCollection('albums');
const otherAlbums = allAlbums
  .filter(a => a.slug !== slug)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 5);

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
  });
};

const formatShortDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
  });
};
---

<BaseLayout title={`${title} - Nate Otenti`} description={description}>
  <main class="min-h-screen p-8">
    <div class="max-w-7xl mx-auto p-8">
      <div class="flex flex-col lg:flex-row lg:gap-16">
        <!-- Main content -->
        <article class="flex-1 max-w-4xl">
          <a href="/life" class="font-mono text-sm text-stone-400 hover:text-accent mb-8 inline-block">&larr; life</a>

          <header class="mb-8">
            <h1 class="text-3xl md:text-4xl font-semibold text-stone-900 mb-3">{title}</h1>
            <div class="flex flex-wrap items-center gap-3 text-sm text-stone-500">
              <time class="font-mono">{formatDate(date)}</time>
              {location && (
                <>
                  <span class="text-stone-300">Â·</span>
                  <span>{location}</span>
                </>
              )}
            </div>
          </header>

          {blurb && (
            <p class="text-lg text-stone-600 leading-relaxed mb-10 max-w-2xl">
              {blurb}
            </p>
          )}

          <div class="space-y-2">
            <slot />
          </div>
        </article>

        <!-- Sidebar -->
        {otherAlbums.length > 0 && (
          <aside class="hidden lg:block w-56 flex-shrink-0">
            <div class="sticky top-8">
              <h2 class="text-sm font-medium text-stone-400 mb-4 uppercase tracking-wider">More Albums</h2>
              <nav class="space-y-4">
                {otherAlbums.map((a) => (
                  <a href={`/life/${a.slug}`} class="block group">
                    <span class="text-stone-700 group-hover:text-accent transition-colors text-sm font-medium">
                      {a.data.title}
                    </span>
                    <span class="block text-xs text-stone-400 mt-0.5 font-mono">
                      {formatShortDate(a.data.date)}
                    </span>
                  </a>
                ))}
              </nav>
            </div>
          </aside>
        )}
      </div>
    </div>
  </main>

  <Lightbox />
</BaseLayout>
